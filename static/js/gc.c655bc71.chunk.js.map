{"version":3,"sources":["common/dialog/Title.js","common/SlideUp.js","common/styled/RoutePaper.js","components/game/form/Create.js","components/game/form/ByName.js","utils/isSafari.js","common/qr/VideoStream.js","common/qr/Scan.js","components/game/form/ByScan.js"],"names":["StyledWrapper","styled","h4","themeColors","border","StyledContainer","div","StyledText","Typography","attrs","component","variant","forwardRef","ref","children","onClose","props","color","onClick","direction","useStyles","makeStyles","root","alignItems","display","flex","flexDirection","justifyContent","margin","padding","CommonRoutePaper","classes","role","elevation","GameFormCreate","t","useTranslation","navigate","useNavigate","pathname","useLocation","style","id","value","replace","onChange","_","route","label","icon","GameFormByName","newName","setNewName","useState","dispatch","useContext","GameStoreContext","error","onSubmit","useValidation","name","errorMessage","Date","now","toString","createGame","onEnter","size","aria-label","isSafari","ua","navigator","userAgent","toLowerCase","indexOf","videoStyles","CommonVideoStream","Component","constructor","super","stream","streamWidth","streamHeight","video","canvasContext","stopCamera","this","getTracks","map","stop","startCamera","async","mediaDevices","getUserMedia","Error","cameras","enumerateDevices","filter","device","kind","videoMode","facingMode","length","cameraIndex","rearCamera","cameraEnv","exact","deviceId","audio","undefined","srcObject","mozSrcObject","window","URL","createObjectURL","src","webkitURL","playsInline","play","streamLoadedPromise","videoWidth","videoHeight","canvas","document","createElement","width","height","getContext","Promise","resolve","reject","addEventListener","once","captureFrame","drawImage","getImageData","drawFrame","requestAnimationFrame","onFrame","data","state","onInit","strean","e","setState","componentWillUnmount","render","fallback","v","defaultProps","CommonQrScan","className","videoStyle","shouldDecode","fallbackCode","fallbackMedia","tryAgainButtonLabel","giveUpButtonLabel","noop","onCode","webWorker","useRef","drawVideoFrame","codeError","setCodeError","onFrameDecoded","useCallback","event","code","JSON","parse","current","useEffect","Worker","process","terminate","appliedStyle","maxWidth","overflow","DialogActions","paddingRight","VideoStream","frameData","postMessage","GameFormByScan","setCode","handleScan","newCode","handleClose","createdAt","useMemo","parseInt","toDateString","Dialog","aria-labelledby","open","fullScreen","TransitionComponent","SlideUp","DialogContent","WarnPlaceholder","message","CardHeader","title","subheader","date","teams","CommaList","items","keyedBy","attribute","Fab","newGame","importGame"],"mappings":"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","file":"static/js/gc.c655bc71.chunk.js","sourcesContent":["import React, { forwardRef } from 'react'\nimport IconButton from '@material-ui/core/IconButton'\nimport Icon from '@material-ui/core/Icon'\nimport Typography from '@material-ui/core/Typography'\nimport styled from 'styled-components'\n\nimport { themeColors } from 'themes'\n\nconst StyledWrapper = styled.h4`\n  border-bottom: 1px solid ${themeColors.border};\n`\n\nconst StyledContainer = styled.div`\n  align-items: center;\n  display: flex;\n  justify-content: flex-start;\n`\n\nconst StyledText = styled(Typography).attrs({\n  component: 'h4',\n  variant: 'overline',\n})`\n  && {\n    margin-left: 0.75rem;\n  }\n`\n\nconst DialogTitle = ({ children, onClose, ...props }, ref) => (\n  <StyledWrapper ref={ref} {...props}>\n    <StyledContainer>\n      <IconButton color=\"primary\" onClick={onClose}>\n        <Icon>close</Icon>\n      </IconButton>\n      <StyledText>{children}</StyledText>\n    </StyledContainer>\n  </StyledWrapper>\n)\n\nexport default forwardRef(DialogTitle)\n","import React, { forwardRef } from 'react'\nimport Slide from '@material-ui/core/Slide'\n\nconst SlideUp = (props, ref) => <Slide ref={ref} direction=\"up\" {...props} />\n\nexport default forwardRef(SlideUp)\n","import React from 'react'\nimport Paper from '@material-ui/core/Paper'\nimport { makeStyles } from '@material-ui/styles'\n\nconst useStyles = makeStyles({\n  root: {\n    alignItems: 'stretch',\n    display: 'flex',\n    flex: '1 1 100%',\n    flexDirection: 'column',\n    justifyContent: 'space-between',\n    margin: '0',\n    padding: '1.5rem',\n  },\n})\n\nconst CommonRoutePaper = ({ children, ...props }) => {\n  const { root } = useStyles()\n  return <Paper classes={{ root }} role=\"tabpanel\" elevation={5} {...props}>{children}</Paper>\n}\n\nexport default CommonRoutePaper\n","import React from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { Outlet, useLocation, useNavigate } from 'react-router-dom'\n\nimport Tabs from '@material-ui/core/Tabs'\nimport Tab from '@material-ui/core/Tab'\nimport KeyboardIcon from '@material-ui/icons/Keyboard'\nimport SpeakerPhoneIcon from '@material-ui/icons/SpeakerPhone'\n\nimport DialogTitle from 'common/dialog/Title'\n\nconst GameFormCreate = () => {\n  const [t] = useTranslation()\n  const navigate = useNavigate()\n  const { pathname } = useLocation()\n\n  const handleChange = (_, route) => {\n    navigate(route || '.')\n  }\n\n  const handleClose = () => navigate('..')\n\n  return (\n    <div\n      style={{\n        flex: '1 1 100%',\n        display: 'flex',\n        flexDirection: 'column',\n      }}\n    >\n      <DialogTitle id=\"game-add-dialog-title\" onClose={handleClose}>\n        {t('game_title')}\n      </DialogTitle>\n      <Tabs value={pathname.replace(/^\\/game\\/?/, '')} onChange={handleChange} variant=\"fullWidth\">\n        <Tab label={t('game_tab_byName')} value=\"\" icon={<KeyboardIcon />} />\n        <Tab label={t('game_tab_byScan')} value=\"scan\" icon={<SpeakerPhoneIcon />} />\n      </Tabs>\n      <Outlet />\n    </div>\n  )\n}\n\nexport default GameFormCreate\n","import React, { useContext, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { useNavigate } from 'react-router-dom'\nimport Fab from '@material-ui/core/Fab'\n\nimport NameField from 'common/NameField'\nimport CommonRoutePaper from 'common/styled/RoutePaper'\nimport GameStoreContext from 'components/game/context/Store'\nimport { createGame } from 'components/game/actionCreators'\nimport useValidation from 'utils/validation'\n\nconst GameFormByName = () => {\n  const [newName, setNewName] = useState('')\n  const navigate = useNavigate()\n  const [t] = useTranslation()\n  const [, dispatch] = useContext(GameStoreContext)\n  const { error, onSubmit } = useValidation({\n    name: newName,\n    errorMessage: 'errors.requiredGameName',\n    onSubmit: () => {\n      const id = Date.now().toString(36)\n      dispatch(createGame(id, newName))\n      navigate(`../games/${id}`)\n    },\n  })\n\n  return (\n    <CommonRoutePaper>\n      <NameField variant=\"outlined\" label={t('placeholder.gameName')} onChange={setNewName} onEnter={onSubmit} error={error} value={newName} />\n      <Fab variant=\"extended\" color=\"primary\" size=\"large\" aria-label={t('button.createGame')} onClick={onSubmit}>\n        {t('button.createGame')}\n      </Fab>\n    </CommonRoutePaper>\n  )\n}\n\nexport default GameFormByName\n","const isSafari = () => {\n  const ua = navigator.userAgent.toLowerCase()\n  return ua.indexOf('safari') !== -1 && ua.indexOf('chrome') === -1\n}\n\nexport default isSafari\n","import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport isSafari from 'utils/isSafari'\n\nconst videoStyles = {\n  display: 'flex',\n}\n\nclass CommonVideoStream extends Component {\n  stream = null\n\n  streamWidth = 0\n\n  streamHeight = 0\n\n  video = null\n\n  canvasContext = null\n\n  constructor(props) {\n    super(props)\n    this.state = {}\n  }\n\n  async componentDidMount() {\n    const { onInit } = this.props\n    try {\n      await this.startCamera()\n      const { strean, video, canvasContext } = this\n      onInit({ strean, video, canvasContext }, this.drawFrame)\n    } catch (e) {\n      this.setState({ error: `Browser camera init error: ${e}` })\n    }\n  }\n\n  componentWillUnmount() {\n    this.stopCamera()\n  }\n\n  stopCamera = () => {\n    if (!this.stream) return\n    this.stream.getTracks().map((t) => t.stop())\n    this.stream = null\n    this.streamWidth = 0\n    this.streamHeight = 0\n    this.canvasContext = null\n  }\n\n  startCamera = async () => {\n    this.stopCamera()\n\n    if (!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia)) {\n      throw new Error('WebRTC API not supported in this browser')\n    }\n\n    const devices = await navigator.mediaDevices.enumerateDevices()\n    const cameras = devices.filter((device) => device.kind === 'videoinput')\n    let videoMode = { facingMode: 'user' }\n    if (cameras.length > 1) {\n      const cameraIndex = this.props.rearCamera ? 1 : 0\n      const cameraEnv = this.props.rearCamera ? 'environment' : 'user'\n      videoMode = isSafari() ? { facingMode: { exact: cameraEnv } } : { deviceId: cameras[cameraIndex].deviceId }\n    }\n\n    this.stream = await navigator.mediaDevices.getUserMedia({\n      audio: false,\n      video: videoMode,\n    })\n\n    if (this.video.srcObject !== undefined) {\n      this.video.srcObject = this.stream\n    } else if (this.video.mozSrcObject !== undefined) {\n      this.video.mozSrcObject = this.stream\n    } else if (window.URL.createObjectURL) {\n      this.video.src = window.URL.createObjectURL(this.stream)\n    } else if (window.webkitURL) {\n      this.video.src = window.webkitURL.createObjectURL(this.stream)\n    } else {\n      this.video.src = this.stream\n    }\n\n    this.video.playsInline = true\n    this.video.play() // firefox does not emit `loadeddata` if video not playing\n    await this.streamLoadedPromise()\n\n    this.streamWidth = this.video.videoWidth\n    this.streamHeight = this.video.videoHeight\n\n    if (!this.canvasContext) {\n      const canvas = document.createElement('canvas')\n      canvas.width = this.streamWidth\n      canvas.height = this.streamHeight\n      this.canvasContext = canvas.getContext('2d')\n    }\n  }\n\n  streamLoadedPromise = () =>\n    new Promise((resolve, reject) => {\n      this.video.addEventListener('loadeddata', resolve, { once: true })\n      this.video.addEventListener('error', reject, { once: true })\n    })\n\n  captureFrame = () => {\n    this.canvasContext.drawImage(this.video, 0, 0, this.streamWidth, this.streamHeight)\n    return this.canvasContext.getImageData(0, 0, this.streamWidth, this.streamHeight)\n  }\n\n  drawFrame = () => {\n    window.requestAnimationFrame(() => {\n      const { onFrame } = this.props\n      if (!this.canvasContext) {\n        return\n      }\n      const { data } = this.captureFrame()\n      onFrame({\n        data,\n        width: this.streamWidth,\n        height: this.streamHeight,\n      })\n    })\n  }\n\n  render() {\n    const { style = {}, fallback = null } = this.props\n    const { error } = this.state\n    return error ? fallback : <video style={{ ...videoStyles, ...style }} ref={(v) => (this.video = v)} />\n  }\n}\n\nCommonVideoStream.propTypes = {\n  onInit: PropTypes.func.isRequired,\n  onFrame: PropTypes.func.isRequired,\n  rearCamera: PropTypes.bool,\n}\n\nCommonVideoStream.defaultProps = {\n  rearCamera: true,\n}\n\nexport default CommonVideoStream\n","import React, {\n  useRef, useEffect, useCallback, useState,\n} from 'react'\nimport { noop } from 'lodash'\nimport DialogActions from '@material-ui/core/DialogActions'\n\nimport VideoStream from './VideoStream'\nimport ButtonExtended from '../button/Extended'\n\nconst CommonQrScan = ({\n  className,\n  style,\n  rearCamera = true,\n  videoStyle,\n  shouldDecode = true,\n  fallbackCode = null,\n  fallbackMedia = null,\n  tryAgainButtonLabel = 'retry',\n  giveUpButtonLabel = 'give up',\n  onInit = noop,\n  onCode = noop,\n  onClose = noop,\n}) => {\n  const webWorker = useRef(null)\n  const drawVideoFrame = useRef(noop)\n  const [codeError, setCodeError] = useState(false)\n  const handleTryAgain = () => setCodeError(false)\n  const onVideoStreamInit = (state, drawFrame) => {\n    if (onInit) {\n      onInit(state)\n    }\n    drawVideoFrame.current = drawFrame\n    if (shouldDecode) {\n      drawVideoFrame.current()\n    }\n  }\n\n  const onFrame = (frameData) => webWorker.current.postMessage(frameData)\n\n  const onFrameDecoded = useCallback((event) => {\n    const code = event.data\n    if (code) {\n      const { data } = code\n      if (onCode && data.length > 0) {\n        try {\n          onCode(JSON.parse(data))\n        } catch (e) {\n          setCodeError(true)\n        }\n      }\n    }\n\n    if (shouldDecode) {\n      drawVideoFrame.current()\n    }\n  }, [onCode, shouldDecode])\n\n  useEffect(() => {\n    webWorker.current = new Worker(`${process.env.PUBLIC_URL || ''}/qr-worker.js`)\n    webWorker.current.addEventListener('message', onFrameDecoded)\n    return () => {\n      if (webWorker.current) {\n        webWorker.current.terminate()\n        webWorker.current = null\n      }\n    }\n  }, [onFrameDecoded])\n\n  const appliedStyle = {\n    display: 'grid',\n    justifyContent: 'center',\n    maxWidth: '100%',\n    margin: '0 auto',\n    overflow: 'hidden',\n    ...style,\n  }\n  return (\n    <div className={className} style={appliedStyle}>\n      {codeError ? (\n        <>\n          {fallbackCode}\n          <DialogActions style={{ paddingRight: 0 }}>\n            <ButtonExtended color=\"default\" size=\"large\" icon=\"arrow_back\" label={giveUpButtonLabel} onClick={onClose} />\n            <ButtonExtended size=\"large\" icon=\"replay\" label={tryAgainButtonLabel} onClick={handleTryAgain} />\n          </DialogActions>\n        </>\n      ) : (\n        <VideoStream\n          onFrame={onFrame}\n          onInit={onVideoStreamInit}\n          rearCamera={rearCamera}\n          style={videoStyle}\n          fallback={fallbackMedia}\n        />\n      )}\n    </div>\n  )\n}\n\nexport default CommonQrScan\n","import React, { useCallback, useContext, useMemo, useState } from 'react'\nimport { useTranslation } from 'react-i18next'\nimport { useNavigate } from 'react-router-dom'\nimport CardHeader from '@material-ui/core/CardHeader'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport Fab from '@material-ui/core/Fab'\nimport Typography from '@material-ui/core/Typography'\n\nimport CommaList from 'common/CommaList'\nimport CommonQrScan from 'common/qr/Scan'\nimport CommonRoutePaper from 'common/styled/RoutePaper'\nimport DialogTitle from 'common/dialog/Title'\nimport SlideUp from 'common/SlideUp'\nimport WarnPlaceholder from 'common/WarnPlaceholder'\nimport GameStoreContext from 'components/game/context/Store'\nimport { importGame } from 'components/game/actionCreators'\n\nconst GameFormByScan = () => {\n  const [t] = useTranslation()\n  const navigate = useNavigate()\n  const [, dispatch] = useContext(GameStoreContext)\n  const [code, setCode] = useState(null)\n  const handleScan = useCallback((newCode) => {\n    setCode(newCode)\n  }, [])\n  const handleClose = () => navigate('..')\n  const handleAdd = () => {\n    const { id, ...newGame } = code\n    dispatch(importGame(id, newGame))\n    navigate(`../games/${id}`)\n  }\n  const createdAt = useMemo(() => {\n    if (code) {\n      const date = new Date(parseInt(code.id, 36))\n      return date.toDateString()\n    }\n    return ''\n  }, [code])\n  return (\n    <CommonRoutePaper>\n      <Dialog id=\"game-scan-dialog\" onClose={handleClose} aria-labelledby=\"game-scan-dialog-title\" open={!code} fullScreen TransitionComponent={SlideUp}>\n        <DialogTitle id=\"game-share-dialog-title\" onClose={handleClose}>\n          {t('game_scan_title')}\n        </DialogTitle>\n        <DialogContent>\n          <CommonQrScan\n            fallbackCode={<WarnPlaceholder icon=\"mobile_off\" message={t('game_scan_wrong_code')} />}\n            fallbackMedia={<WarnPlaceholder icon=\"videocam_off\" message={t('game_scan_no_camera')} />}\n            tryAgainButtonLabel={t('button.tryAgain')}\n            giveUpButtonLabel={t('button.back')}\n            onCode={handleScan}\n            onClose={handleClose}\n          />\n        </DialogContent>\n      </Dialog>\n      {code && (\n        <>\n          <CardHeader title={code.name} subheader={t('messages.createdAt', { date: createdAt })} />\n          {code.teams.length > 0 && (\n            <Typography variant=\"overline\">\n              <CommaList items={code.teams} keyedBy=\"name\" attribute=\"name\" />\n            </Typography>\n          )}\n          <Fab variant=\"extended\" color=\"primary\" size=\"large\" aria-label={t('button.createGame')} onClick={handleAdd}>\n            {t('button.confirmAndCreate')}\n          </Fab>\n        </>\n      )}\n    </CommonRoutePaper>\n  )\n}\n\nexport default GameFormByScan\n"],"sourceRoot":""}